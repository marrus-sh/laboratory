// Generated by CoffeeScript 1.12.4
(function(){"use strict";/*
  
      ............. LABORATORY ..............
  
      A client-side API for Mastodon, a free,
         open-source social network server
                - - by Kibigo! - -
  
          Licensed under the MIT License.
             Source code available at:
      https://github.com/marrus-sh/laboratory
  
                  Version 0.5.0
   */
var Application,Attachment,Authorization,Client,CustomEvent,Enumeral,Exposed,Failure,Laboratory,LaboratoryEvent,Post,Profile,Request,Rolodex,Store,Timeline,checkDecree,decree,dispatch,fn,isArray,police,prop,reflection,reset,run,hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Laboratory={"ℹ":"https://github.com/marrus-sh/laboratory","Nº":5},function(){var Mommy,code;if((code=(location.search.match(/code=([^&]*)/)||[])[1])&&(Mommy=window.opener))Mommy.postMessage(code,window.location.origin)}(),Exposed={ready:!1,auth:null},fn=function(prop){return Object.defineProperty(Laboratory,prop,{enumerable:!0,configurable:!1,get:function(){return Exposed[prop]}})};for(prop in Exposed)fn(prop);decree=police=checkDecree=null,function(){var isPrivileged;isPrivileged=!1,decree=function(callback){var result,wasPrivileged;return wasPrivileged=isPrivileged,isPrivileged=!0,result=callback(),isPrivileged=wasPrivileged,result},police=function(callback){var result,wasPrivileged;return wasPrivileged=isPrivileged,isPrivileged=!1,result=callback(),isPrivileged=wasPrivileged,result},checkDecree=function(){return isPrivileged}}(),CustomEvent=function(){var CE;return"function"==typeof window.CustomEvent?window.CustomEvent:(CE=function(event,params){var e;return params=params||{bubbles:!1,cancelable:!1,detail:void 0},e=document.createEvent("CustomEvent"),e.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),e},CE.prototype=Object.freeze(Object.create(window.Event.prototype)),Object.freeze(CE))}(),reflection=function(){return this},isArray="function"==typeof Array.isArray?Array.isArray:function(n){return"[object Array]"===Object.prototype.toString.call(n)},Enumeral=function(value){if(!(this&&this instanceof Enumeral))throw new TypeError("this is not a Enumeral");return this.value=0|value,Object.freeze(this)},Laboratory.Enumeral=function(value){throw new TypeError("Illegal constructor")},Object.defineProperty(Enumeral,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.defineProperties({},{constructor:{enumerable:!1,value:Laboratory.Enumeral},toString:{enumerable:!1,value:function(){return"Enumeral("+this.value+")"}},toSource:{enumerable:!1,value:function(){return"Enumeral("+this.value+")"}},valueOf:{enumerable:!1,value:function(){return this.value}}}))}),Object.defineProperty(Laboratory.Enumeral,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Enumeral.prototype}),Enumeral.generate=function(data){var byValue,enumeral,type,value;type=function(n){return Enumeral.call(this,n)},type.prototype=Object.create(Enumeral.prototype),byValue={};for(enumeral in data)hasProp.call(data,enumeral)&&(value=data[enumeral],null==byValue[value]&&(type[enumeral]=new type(value),byValue[value]=type[enumeral]));return type.fromValue=function(n){return byValue[0|n]},Object.freeze(type)},Laboratory.Application=Application=function(data){if(!(this&&this instanceof Application))throw new TypeError("this is not an Application");if(null==data)throw new TypeError("Unable to create Application; no data provided");return this.name=data.name,this.href=data.website,Object.freeze(this)},Object.defineProperty(Application,"prototype",{value:Object.freeze({})}),Laboratory.Attachment=Attachment=function(data){if(!(this&&this instanceof Attachment))throw new TypeError("this is not an Attachment");if(null==data)throw new TypeError("Unable to create Attachment; no data provided");return this.id=Number(data.id),this.href=String(data.url),this.preview=String(data.preview_url),this.type=function(){switch(data.type){case"image":return Attachment.Type.IMAGE;case"video":return Attachment.Type.VIDEO;case"gifv":return Attachment.Type.GIFV;default:return Attachment.Type.UNKNOWN}}(),Object.freeze(this)},Object.defineProperty(Attachment,"prototype",{value:Object.freeze({})}),Attachment.Type=Enumeral.generate({UNKNOWN:0,PHOTO:1,VIDEO:2,GIFV:3}),Laboratory.Authorization=Authorization=function(data,origin,me){var scopes;if(!(this&&this instanceof Authorization))throw new TypeError("this is not an Authorization");if(null==data)throw new TypeError("Unable to create Authorization; no data provided");return this.origin=String(origin),this.accessToken=String(data.access_token),this.datetime=new Date(data.created_at),this.scope=Authorization.Scope.fromValue(Authorization.Scope.READ*(indexOf.call(scopes=String(data.scope).split(/[\s\+]+/g),"read")<0)+Authorization.Scope.WRITE*(indexOf.call(scopes,"write")<0)+Authorization.Scope.FOLLOW*(indexOf.call(scopes,"follow")<0)),this.tokenType=String(data.tokenType),this.me=+me,Object.freeze(this)},Object.defineProperty(Authorization,"prototype",{value:Object.freeze({})}),Authorization.Scope=Enumeral.generate({NONE:0,READ:1,WRITE:2,READWRITE:3,FOLLOW:4,READFOLLOW:5,WRITEFOLLOW:6,READWRITEFOLLOW:7}),Laboratory.Client=Client=function(data,origin,name,scope){if(!(this&&this instanceof Client))throw new TypeError("this is not a Client");if(null==data)throw new TypeError("Unable to create Client; no data provided");return this.origin=origin,this.name=name,this.id=data.id,this.clientID=data.client_id,this.clientSecret=data.client_secret,this.scope=scope,this.redirect=data.redirect_uri,Object.freeze(this)},Object.defineProperty(Client,"prototype",{value:Object.freeze({})}),Laboratory.Failure=Failure=function(data,code){if(!(this&&this instanceof Failure))throw new TypeError("this is not a Failure");if(null==data)throw new TypeError("Unable to create Failure; no data provided");return this.error=String(data.error),isFinite(this.code=Number(code))||(this.code=null),Object.freeze(this)},Object.defineProperty(Failure,"prototype",{value:Object.freeze({})}),Laboratory.Post=Post=function(data){var fromID,getProfile,item,profiles;if(!(this&&this instanceof Post))throw new TypeError("this is not a Post");if(null==data)throw new TypeError("Unable to create Post; no data provided");if(profiles=Store.profiles,getProfile=function(id){return profiles[id]},null!=data.type){if(this.id=data.id,fromID=data.account.id,!data.status){switch(Object.defineProperty(this,"author",{get:getProfile.bind(this,fromID),enumerable:!0}),data.type){case"follow":this.type=Post.Type.FOLLOW;break;default:this.type=Post.Type.NOTIFICATION}return Object.freeze(this)}switch(data.type){case"reblog":this.type=Post.Type.REBLOG,Object.defineProperty(this,"rebloggedBy",{get:getProfile.bind(this,fromID),enumerable:!0});break;case"favourite":this.type=Post.Type.FAVOURITE,Object.defineProperty(this,"favouritedBy",{get:getProfile.bind(this,fromID),enumerable:!0});break;case"mention":this.type=Post.Type.MENTION;break;default:this.type=Post.Type.REACTION}data=data.status}else this.type=Post.Type.STATUS,this.id=data.id,data.reblog&&(Object.defineProperty(this,"rebloggedBy",{get:getProfile.bind(this,data.account.id),enumerable:!0}),data=data.reblog);return this.uri=String(data.uri),this.href=String(data.url),Object.defineProperty(this,"author",{get:getProfile.bind(this,data.account.id),enumerable:!0}),this.inReplyTo=Number(data.in_reply_to_id),this.content=String(data.content),this.datetime=new Date(data.created_at),this.reblogCount=Number(data.reblogs_count),this.favouriteCount=Number(data.favourites_count),this.isReblogged=!!data.reblogged,this.isFavourited=!!data.favourited,this.isNSFW=!!data.sensitive,this.message=String(data.spoiler_text),this.visibility={direct:Post.Visibility.DIRECT,private:Post.Visibility.IN_HOME,unlisted:Post.Visibility.UNLISTED,public:Post.Visibility.PUBLIC}[data.visibility]||Post.Visibility.IN_HOME,this.mediaAttachments=function(){var i,len,ref,results;for(ref=data.media_attachments,results=[],i=0,len=ref.length;i<len;i++)item=ref[i],results.push(new Attachment(item));return results}(),this.mentions=function(_this){return function(){var i,index,len,mention,mentions,ref;for(mentions=[],ref=data.mentions,index=i=0,len=ref.length;i<len;index=++i)mention=ref[index],Object.defineProperty(mentions,index,{enumerable:!0,get:getProfile.bind(_this,mention.id)});return Object.freeze(mentions)}}(this)(),this.application=null!=data.application?new Application(data.application):null,Object.freeze(this)},Object.defineProperty(Post,"prototype",{value:Object.freeze({compare:function(other){return this instanceof Post&&other instanceof Post&&(this.type===other.type&&this.id===other.id&&this.reblogCount===other.reblogCount&&this.favouriteCount===other.favouriteCount&&this.isReblogged===other.isReblogged&&this.isFavourited===other.isFavourited)}})}),Post.Type=Enumeral.generate({UNKNOWN:0,STATUS:16,NOTIFICATION:32,FOLLOW:33,REACTION:48,FAVOURITE:49,REBLOG:50,MENTION:51}),Post.Visibility=Enumeral.generate({DIRECT:0,REBLOGGABLE:1,IN_HOME:2,UNLISTED:3,LISTED:4,NOT_IN_HOME:5,UNREBLOGGABLE:6,PUBLIC:7}),Laboratory.Profile=Profile=function(data,relationship){var origin,ref;if(!(this&&this instanceof Profile))throw new TypeError("this is not a Profile");if(null==data)throw new TypeError("Unable to create Profile; no data provided");return null==relationship&&(relationship=null!=(ref=Store.profiles[data.id])?ref.relationship:void 0),data instanceof Profile?(this.id=data.id,this.username=data.username,this.account=data.account,this.localAccount=data.localAccount,this.displayName=data.displayName,this.bio=data.bio,this.href=data.href,this.avatar=data.avatar,this.header=data.header,this.isLocked=data.isLocked,this.followerCount=data.followerCount,this.followingCount=data.followingCount,this.statusCount=data.statusCount,this.relationship=data.relationship):(this.id=Number(data.id),this.username=String(data.username),this.account=String(data.acct+(null!=(origin=Store.auth.origin)&&indexOf.call(data.acct,"@")<0?"@"+origin.substr(8):"")),this.localAccount=String(data.acct),this.displayName=String(data.display_name),this.bio=String(data.note),this.href=String(data.url),this.avatar=String(data.avatar),this.header=String(data.header),this.isLocked=!!data.locked,this.followerCount=Number(data.followers_count),this.followingCount=Number(data.following_count),this.statusCount=Number(data.statuses_count),this.relationship=data.id===Store.auth.me?Profile.Relationship.SELF:Profile.Relationship.UNKNOWN),null!=relationship&&(this.relationship=Profile.Relationship.fromValue(relationship)||this.relationship),Object.freeze(this)},Object.defineProperty(Profile,"prototype",{value:Object.freeze({compare:function(other){return this instanceof Profile&&other instanceof Profile&&(this.id===other.id&&this.relationship===other.relationship&&this.followerCount===other.followerCount&&this.followingCount===other.followingCount&&this.statusCount===other.statusCount&&this.bio===other.bio&&this.displayName===other.displayName&&this.avatar===other.avatar&&this.header===other.header&&this.isLocked===other.isLocked&&this.username===other.username&&this.localAccount===other.localAccount&&this.account===other.account&&this.href===other.href)}})}),Profile.Relationship=Enumeral.generate({NOT_FOLLOWING:0,FOLLOWER:1,FOLLOWING:2,MUTUAL:3,REQUESTED:4,REQUESTED_MUTUAL:5,BLOCKING:8,MUTING:16,MUTING_FOLLOWER:17,MUTING_FOLLOWING:18,MUTING_MUTUAL:19,MUTING_REQUESTED:20,MUTING_REQUESTED_MUTUAL:21,UNKNOWN:64,SELF:128}),Request=void 0,function(){var assign,finish,getResponse,remove,setResponse,start,stop;setResponse=function(stored,n){if(checkDecree())return police(function(_this){return function(){var callback,i,len,ref;for(stored.response=n,ref=stored.callbacks,i=0,len=ref.length;i<len;i++)"function"==typeof(callback=ref[i])&&callback.call(_this,_this.response)}}(this))},getResponse=function(stored){return stored.response},finish=function(request,onComplete){var link,params,result,status;switch(request.readyState){case 0:break;case 1:dispatch("LaboratoryRequestOpen",request);break;case 2:case 3:dispatch("LaboratoryRequestUpdate",request);break;case 4:switch(status=request.status,result=function(){try{return request.responseText?JSON.parse(request.responseText):{}}catch(error){return{error:"The response could not be parsed."}}}(),link=request.getResponseHeader("Link"),params={status:status,url:location,prev:((null!=link?link.match(/<\s*([^,]*)\s*>\s*;(?:[^,]*[;\s])?rel="?prev(?:ious)?"?/):void 0)||[])[1],next:((null!=link?link.match(/<\s*([^,]*)\s*>\s*;(?:[^,]*[;\s])?rel="?next"?/):void 0)||[])[1]},!1){case!(200<=status&&status<=205):null!=(null!=result?result.error:void 0)?(decree(function(_this){return function(){return _this.response=police(function(){return new Failure(result,status)})}}(this)),dispatch("LaboratoryRequestError",request)):("function"==typeof onComplete&&onComplete(result,params),dispatch("LaboratoryRequestComplete",request));break;default:decree(function(_this){return function(){return _this.response=police(function(){return new Failure(result,status)})}}(this)),dispatch("LaboratoryRequestError",request)}}},assign=function(stored,callback){if("function"!=typeof callback)throw new TypeError("Provided callback was not a function");return indexOf.call(stored.callbacks,callback)<0&&stored.callbacks.push(callback),this},remove=function(stored,callback){for(var index;(index=stored.callbacks.indexOf(callback))!==-1;)stored.callbacks.splice(index,1);return this},start=function(stored){var contents,method,request,token;(request=stored.request)instanceof XMLHttpRequest&&(this.stop(),contents=stored.contents,token=stored.token,request.open(method=stored.method,stored.location),"POST"!==method||"undefined"!=typeof FormData&&null!==FormData&&contents instanceof FormData||request.setRequestHeader("Content-type","application/x-www-form-urlencoded"),null!=token&&request.setRequestHeader("Authorization","Bearer "+token),request.addEventListener("readystatechange",stored.callback),request.send("POST"===method?contents:void 0))},stop=function(stored){var request;(request=stored.request)instanceof XMLHttpRequest&&(request.removeEventListener("readystatechange",stored.callback),request.abort())},Request=function(method,location,data,token,onComplete){var contents,key,stored,subvalue,value;if(!(this&&this instanceof Request))throw new TypeError("this is not a Request");return data=Object(data),stored={callback:void 0,callbacks:[],contents:void 0,location:location=String(location),method:method=String(method),request:void 0,response:null,token:null!=token?String(token):void 0},Object.defineProperties(this,{assign:{configurable:!0,enumerable:!1,writable:!1,value:assign.bind(this,stored)},remove:{configurable:!0,enumerable:!1,writable:!1,value:remove.bind(this,stored)},response:{configurable:!0,enumerable:!0,get:getResponse.bind(this,stored),set:setResponse.bind(this,stored)},start:{configurable:!0,enumerable:!1,writable:!1,value:start.bind(this,stored)},stop:{configurable:!0,enumerable:!1,writable:!1,value:stop.bind(this,stored)}}),"GET"!==method&&"POST"!==method&&"DELETE"!==method?this:(stored.callback=finish.bind(this,stored.request=new XMLHttpRequest,onComplete),stored.contents=contents="POST"===method&&"function"==typeof FormData&&data instanceof FormData?data:function(){var results;results=[];for(key in data)null!=(value=data[key])&&(isArray(value)?results.push(function(){var i,len,results1;for(results1=[],i=0,len=value.length;i<len;i++)subvalue=value[i],results1.push(encodeURIComponent(key)+"[]="+encodeURIComponent(subvalue));return results1}().join("&")):results.push(encodeURIComponent(key)+"="+encodeURIComponent(value)));return results}().join("&").replace(/%20/g,"+"),""!==contents&&"POST"!==method&&(stored.location+=(indexOf.call(location,"?")>=0?"&":"?")+contents),this)},Laboratory.Request=function(data){throw new TypeError("Illegal constructor")},Object.defineProperty(Request,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Object.prototype,{assign:{enumerable:!1,value:function(){}},constructor:{enumerable:!1,value:Laboratory.Request},go:{enumerable:!1,value:function(){return new Promise(function(_this){return function(resolve,reject){var callback;return callback=function(response){return(response instanceof Failure?reject:resolve).call(_this,response),_this.remove(callback)},_this.assign(callback),_this.start}}(this))}},remove:{enumerable:!1,value:function(){}},start:{enumerable:!1,value:function(){}},stop:{enumerable:!1,value:function(){}}}))}),Object.defineProperty(Laboratory.Request,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Request.prototype})}(),Laboratory.Rolodex=Rolodex=function(data){var current,currentID,getProfile,i,index,j,len,prev,ref,value;if(!(this&&this instanceof Rolodex))throw new TypeError("this is not a Rolodex");if(null==data)throw new TypeError("Unable to create Rolodex; no data provided");if(getProfile=function(id){return Store.profiles[id]},data.sort(function(first,second){return second.id-first.id}),prev=null,data.length>0)for(index=i=ref=data.length-1;ref<=0?i<=0:i>=0;index=ref<=0?++i:--i)currentID=(current=data[index]).id,null==prev||currentID!==prev.id?prev=current:data.splice(index,1);for(this.profiles=[],index=j=0,len=data.length;j<len;index=++j)value=data[index],Object.defineProperty(this.profiles,index,{enumerable:!0,get:getProfile.bind(this,value.id)});return Object.freeze(this.profiles),this.length=data.length,Object.freeze(this)},Object.defineProperty(Rolodex,"prototype",{value:Object.freeze({join:function(data){var combined,i,j,len,len1,profile,ref,ref1;if(!(data instanceof Profile||data instanceof Array||data instanceof Rolodex))return this;for(ref=function(){switch(!1){case!(data instanceof Profile):return[data];case!(data instanceof Rolodex):return data.profiles;default:return data}}(),i=0,len=ref.length;i<len;i++)profile=ref[i],combined=profile;for(ref1=this.profiles,j=0,len1=ref1.length;j<len1;j++)profile=ref1[j],combined.push(profile);return new Rolodex(combined)},remove:function(data){var i,index,len,profile,redacted,ref;if(!(data instanceof Profile||data instanceof Array||data instanceof Rolodex))return this;for(redacted=function(){var i,len,ref,results;for(ref=this.profiles,results=[],i=0,len=ref.length;i<len;i++)profile=ref[i],results.push(profile);return results}.call(this),ref=function(){switch(!1){case!(data instanceof Profile):return[data];case!(data instanceof Rolodex):return data.profiles;default:return data}}(),i=0,len=ref.length;i<len;i++)profile=ref[i],(index=redacted.indexOf(profile))!==-1&&redacted.splice(index,1);return new Rolodex(redacted)}})}),Rolodex.Type=Enumeral.generate({UNDEFINED:0,SEARCH:16,FOLLOWERS:33,FOLLOWING:34,FAVOURITED_BY:65,REBLOGGED_BY:69,BLOCKS:131,MUTES:132,FOLLOW_REQUESTS:134}),Laboratory.Timeline=Timeline=function(data){var current,currentID,getPost,i,index,isNotification,j,len,prev,ref,value;if(!(this&&this instanceof Timeline))throw new TypeError("this is not a Timeline");if(null==data)throw new TypeError("Unable to create Timeline; no data provided");if(isNotification=function(object){return!!(function(){switch(!1){case!(object instanceof Post):return object.type;case null==object.type:return Post.Type.NOTIFICATION;default:return Post.Type.STATUS}}()&Post.Type.NOTIFICATION)},getPost=function(id,isANotification){return isANotification?Store.notifications[id]:Store.statuses[id]},data.sort(function(first,second){var a,b;return isNotification(first)||isNotification(second)||(a=Number(first instanceof Post&&first.datetime||Date(first.created_at)))===(b=Number(second instanceof Post&&second.datetime||Date(second.created_at)))?second.id-first.id:2*(a>b)-1}),prev=null,data.length>0)for(index=i=ref=data.length-1;ref<=0?i<=0:i>=0;index=ref<=0?++i:--i)currentID=(current=data[index]).id,null==prev||currentID!==prev.id||isNotification(prev)!==isNotification(current)?prev=current:data.splice(index,1);for(this.posts=[],index=j=0,len=data.length;j<len;index=++j)value=data[index],Object.defineProperty(this.posts,index,{enumerable:!0,get:getPost.bind(this,value.id,isNotification(value))});return Object.freeze(this.posts),this.length=data.length,Object.freeze(this)},Object.defineProperty(Timeline,"prototype",{value:Object.freeze({join:function(data){var combined,i,j,len,len1,post,ref,ref1;if(!(data instanceof Post||data instanceof Array||data instanceof Timeline))return this;for(ref=function(){switch(!1){case!(data instanceof Post):return[data];case!(data instanceof Timeline):return data.posts;default:return data}}(),i=0,len=ref.length;i<len;i++)post=ref[i],combined=post;for(ref1=this.posts,j=0,len1=ref1.length;j<len1;j++)post=ref1[j],combined.push(post);return new Timeline(combined)},remove:function(data){var i,index,len,post,redacted,ref;if(!(data instanceof Post||data instanceof Array||data instanceof Timeline))return this;for(redacted=function(){var i,len,ref,results;for(ref=this.posts,results=[],i=0,len=ref.length;i<len;i++)post=ref[i],results.push(post);return results}.call(this),ref=function(){switch(!1){case!(data instanceof Post):return[data];case!(data instanceof Timeline):return data.posts;default:return data}}(),i=0,len=ref.length;i<len;i++)post=ref[i],(index=redacted.indexOf(post))!==-1&&redacted.splice(index,1);return new Timeline(redacted)}})}),Timeline.Type=Enumeral.generate({UNDEFINED:0,PUBLIC:16,HOME:32,NOTIFICATIONS:33,FAVOURITES:34,ACCOUNT:64,HASHTAG:128}),LaboratoryEvent={Events:{},Handlers:[],create:function(type,detail){return null==LaboratoryEvent.Events[type]&&(LaboratoryEvent.Events[type]=Object(detail)),LaboratoryEvent},handle:function(type,callback){return null==LaboratoryEvent.Events[type=String(type)]?LaboratoryEvent:(callback.type=type,LaboratoryEvent.Handlers.push(callback),LaboratoryEvent)}},Laboratory.dispatch=dispatch=function(event,props){var detail,initial,initials;if(null==(initials=LaboratoryEvent.Events[event=String(event)]))return!1;if("function"==typeof initials){if(!((detail=props)instanceof initials))return!1}else if(null!=props){detail={};for(prop in initials)initial=initials[prop],detail[prop]=null!=props[prop]?props[prop]:initial;Object.freeze(detail)}return document.dispatchEvent(new CustomEvent(event,{detail:detail})),!0},Object.defineProperty(Attachment,"Request",{configurable:!1,enumerable:!0,writable:!1,value:function(){var AttachmentRequest;return AttachmentRequest=function(data){var file,form;if(!(this&&this instanceof AttachmentRequest))throw new TypeError("this is not an AttachmentRequest");if(!("function"==typeof File&&(file=data.file)instanceof File))throw new TypeError("Unable to create attachment; none provided");if("function"!=typeof FormData)throw new TypeError("Unable to create attachment; `FormData` not supported");return form=new FormData,form.append("file",file),Request.call(this,"POST",Store.auth.origin+"/api/v1/media",form,Store.auth.accessToken,function(_this){return function(result){return dispatch("LaboratoryAttachmentReceived",decree(function(){return _this.response=police(function(){return new Attachment(result)})}))}}(this)),Object.freeze(this)},Object.defineProperty(AttachmentRequest,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:AttachmentRequest}}))}),AttachmentRequest}()}),Object.defineProperty(Authorization,"Request",{configurable:!1,enumerable:!0,writable:!1,value:function(){var AuthorizationRequest,finishRequest,getToken,makeRequest,startRequest,stopRequest;return stopRequest=function(){var ref;if(!((null!=this?this.currentRequest:void 0)instanceof Authorization.Request))throw new TypeError("No defined AuthorizationRequest");"function"==typeof this.wrapup&&this.wrapup(),"function"==typeof(null!=(ref=this.waitingRequest)?ref.stop:void 0)&&this.waitingRequest.stop(),this.window instanceof Window&&this.window.close(),this.waitingRequest=this.callback=this.window=void 0},startRequest=function(window){var accessToken,handleClient,ref,scopeList,storedAccessToken,storedRedirect,storedScope,timeout;if(!((null!=this?this.currentRequest:void 0)instanceof Authorization.Request))throw new TypeError("No defined AuthorizationRequest");if(this.currentRequest.stop(),null==window||window.closed||(this.window=window),ref=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.getItem("Laboratory | "+this.origin):void 0)?localStorage.getItem("Laboratory | "+this.origin).split(" ",5):[],storedRedirect=ref[0],this.clientID=ref[1],this.clientSecret=ref[2],storedScope=ref[3],storedAccessToken=ref[4],(accessToken=this.accessToken)||(accessToken=storedAccessToken)&&(this.scope&storedScope)==+this.scope)return void finishRequest.call(this,{access_token:accessToken,created_at:NaN,scope:(scopeList=[],this.scope&Authorization.Scope.READ&&scopeList.push("read"),this.scope&Authorization.Scope.WRITE&&scopeList.push("write"),this.scope&Authorization.Scope.FOLLOW&&scopeList.push("follow"),scopeList.join(" ")),token_type:"bearer"});storedRedirect===this.redirect&&(this.scope&storedScope)==+this.scope&&this.clientID&&this.clientSecret?makeRequest.call(this):(handleClient=function(_this){return function(client){var ref1;if(client instanceof Client&&_this.currentRequest&&client.origin===_this.origin&&(_this.scope&client.scope)==+_this.scope&&client.redirect===_this.redirect&&client.clientID&&client.clientSecret)return ref1=[client.clientID,client.clientSecret],_this.clientID=ref1[0],_this.clientSecret=ref1[1],localStorage.setItem("Laboratory | "+_this.origin,[client.redirect,client.clientID,client.clientSecret,+client.scope].join(" ")),clearTimeout(timeout),_this.wrapup=void 0,_this.waitingRequest.stop(),_this.waitingRequest.remove(handleClient),makeRequest.call(_this)}}(this),this.waitingRequest=new Client.Request({name:this.name,origin:this.origin,redirect:this.redirect,scope:this.scope}),this.waitingRequest.assign(handleClient),this.wrapup=function(_this){return function(){return _this.waitingRequest.remove(handleClient)}}(this),this.waitingRequest.start(),timeout=setTimeout(function(_this){return function(){return _this.currentRequest.stop(),_this.waitingRequest.stop(),decree(function(){return _this.response=police(function(){return new Failure("Unable to authorize client")})})}}(this),3e4))},makeRequest=function(){var callback,key,location,scopeList,value;if(!((null!=this?this.currentRequest:void 0)instanceof Authorization.Request))throw new TypeError("No defined AuthorizationRequest");return location=this.origin+"/oauth/authorize?"+function(){var ref,results;ref={client_id:this.clientID,response_type:"code",redirect_uri:this.redirect,scope:(scopeList=[],this.scope&Authorization.Scope.READ&&scopeList.push("read"),this.scope&Authorization.Scope.WRITE&&scopeList.push("write"),this.scope&Authorization.Scope.FOLLOW&&scopeList.push("follow"),scopeList.join(" "))},results=[];for(key in ref)value=ref[key],results.push(encodeURIComponent(key)+"="+encodeURIComponent(value));return results}.call(this).join("&"),this.window?this.window.location=location:this.window=window.open(location,"LaboratoryOAuth"),callback=function(_this){return function(event){if(event.source===_this.window&&event.origin===window.location.origin)return getToken.call(_this,event.data),event.source.close(),_this.window=null,_this.wrapup=void 0,window.removeEventListener("message",callback),callback=void 0}}(this),window.addEventListener("message",callback),this.wrapup=function(){return window.removeEventListener("message",callback)}},getToken=function(code){var ref;if(!((null!=this?this.currentRequest:void 0)instanceof Authorization.Request))throw new TypeError("No defined AuthorizationRequest");return"function"==typeof(null!=(ref=this.waitingRequest)?ref.stop:void 0)&&this.waitingRequest.stop(),(this.waitingRequest=new Request("POST",this.origin+"/oauth/token",{client_id:this.clientID,client_secret:this.clientSecret,redirect_uri:this.redirect,grant_type:"authorization_code",code:code},null,finishRequest.bind(this))).start()},finishRequest=function(result){var location,ref;if(!((null!=this?this.currentRequest:void 0)instanceof Authorization.Request))throw new TypeError("No defined AuthorizationRequest");return"function"==typeof(null!=(ref=this.waitingRequest)?ref.stop:void 0)&&this.waitingRequest.stop(),location=this.origin+"/api/v1/accounts/verify_credentials",this.accessToken=String(result.access_token),(this.waitingRequest=new Request("GET",location,null,this.accessToken,function(_this){return function(mine){var scopes;return decree(function(){return _this.currentRequest.response=police(function(){return new Authorization(result,_this.origin,mine.id)})}),dispatch("LaboratoryAuthorizationReceived",_this.currentRequest.response),localStorage.setItem("Laboratory | "+_this.origin,[_this.redirect,_this.clientID,_this.clientSecret,Authorization.Scope.READ*(indexOf.call(scopes=result.scope.split(/[\s\+]+/g),"read")>=0)+Authorization.Scope.WRITE*(indexOf.call(scopes,"write")>=0)+Authorization.Scope.FOLLOW*(indexOf.call(scopes,"follow")>=0),_this.accessToken].join(" ")),dispatch("LaboratoryProfileReceived",new Profile(mine)),_this.currentRequest.stop()}}(this))).start()},AuthorizationRequest=function(data){var a,recalled;if(!(this&&this instanceof AuthorizationRequest))throw new TypeError("this is not an AuthorizationRequest");return recalled={currentRequest:this,waitingRequest:void 0,callback:void 0,scope:data.scope instanceof Authorization.Scope?data.scope:Authorization.Scope.READ,name:null!=data.name?String(data.name):"Laboratory",accessToken:null!=data.accessToken?String(data.accessToken):void 0,window:void 0,clientID:void 0,clientSecret:void 0,origin:(a=document.createElement("a"),a.href=data.origin||"/",a.origin),redirect:(a.href=data.redirect||"",a.href)},Request.call(this),Object.defineProperties(this,{start:{enumerable:!1,value:startRequest.bind(recalled)},stop:{enumerable:!1,value:stopRequest.bind(recalled)}}),Object.freeze(this)},Object.defineProperty(AuthorizationRequest,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:AuthorizationRequest}}))}),AuthorizationRequest}()},LaboratoryEvent.create("LaboratoryAuthorizationReceived",Authorization).handle("LaboratoryAuthorizationReceived",function(event){if(event.detail instanceof Authorization)return reset(),Exposed.auth=Store.auth=event.detail})),Object.defineProperty(Client,"Request",{configurable:!1,enumerable:!0,writable:!1,value:function(){var ClientRequest;return ClientRequest=function(data){var a,name,origin,redirect,scope,scopeList;if(!(this&&this instanceof ClientRequest))throw new TypeError("this is not a ClientRequest");return name=String(data.name)||"Laboratory",scope=data.scope instanceof Authorization.Scope?data.scope:Authorization.Scope.READ,a=document.createElement("a"),a.href=data.origin||"/",origin=a.origin,a.href=data.redirect||"",redirect=a.href,Request.call(this,"POST",origin+"/api/v1/apps",{client_name:name,redirect_uris:redirect,scopes:(scopeList=[],scope&Authorization.Scope.READ&&scopeList.push("read"),scope&Authorization.Scope.WRITE&&scopeList.push("write"),scope&Authorization.Scope.FOLLOW&&scopeList.push("follow"),scopeList.join(" "))},null,function(_this){return function(result){return dispatch("LaboratoryClientReceived",decree(function(){return _this.response=police(function(){return new Client(result,origin,name,scope)})}))}}(this)),Object.freeze(this)},Object.defineProperty(ClientRequest,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:ClientRequest}}))}),ClientRequest}()}),LaboratoryEvent.create("LaboratoryClientReceived",Client),LaboratoryEvent.create("LaboratoryInitializationLoaded").create("LaboratoryInitializationReady"),Object.defineProperties(Post,{Request:{configurable:!1,enumerable:!0,writable:!1,value:function(){var PostRequest;return PostRequest=function(data,isLive,useCached){var callback,isNotification,postID,ref,requestStart,requestStop,store,type;if(null==isLive&&(isLive=!0),null==useCached&&(useCached=!0),
!(this&&this instanceof PostRequest))throw new TypeError("this is not a PostRequest");if(!(Infinity>(ref=postID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to request post; no id provided");return(type=Post.Type.fromValue(data.type))&&type!==Post.Type.UNKNOWN||(type=Post.Type.STATUS),isNotification=type&Post.Type.NOTIFICATION,store=isNotification?Store.notifications:Store.statuses,callback=function(_this){return function(event){var response;if((response=event.detail)instanceof Post&&response.id===postID&&(response.type&Post.Type.NOTIFICATION)===isNotification&&(null!=response.compare&&response.compare(_this.response)||decree(function(){return _this.response=response}),!isLive))return _this.stop()}}(this),Request.call(this,"GET",Store.auth.origin+(isNotification?"/api/v1/notifications/":"/api/v1/statuses/")+postID,null,Store.auth.accessToken,function(_this){return function(result){var post;return result.id!==postID?void _this.dispatchEvent(new CustomEvent("failure",{request:_this,response:new Failure("Unable to fetch post; returned post did not match requested id")})):(post=new Post(result),(post.type&Post.Type.NOTIFICATION)!==isNotification?void _this.dispatchEvent(new CustomEvent("failure",{request:_this,response:new Failure("Unable to fetch post; returned post was not of specified type")})):dispatch("LaboratoryPostReceived",post))}}(this)),requestStart=this.start,requestStop=this.stop,Object.defineProperties(this,{start:{enumerable:!1,value:function(){if(!(useCached&&store[postID]instanceof Post)||(decree(function(_this){return function(){return _this.response=store[postID]}}(this)),isLive))return document.addEventListener("LaboratoryPostReceived",callback),requestStart()}},stop:{enumerable:!1,value:function(){return document.removeEventListener("LaboratoryPostReceived",callback),requestStop()}}}),Object.freeze(this)},Object.defineProperty(PostRequest,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:PostRequest}}))}),PostRequest}()},Create:{configurable:!1,enumerable:!0,writable:!1,value:function(){var PostCreate;return PostCreate=function(data){var attachment,attachments,inReplyTo,makeNSFW,message,ref,text,visibility;if(!(this&&this instanceof PostCreate))throw new TypeError("this is not a PostCreate");if(!(null!=data?data.text:void 0))throw new TypeError("Unable to create post; no text provided");return text=String(data.text),(visibility=Post.Visibility.fromValue(data.visibility))||(visibility=Post.Visibility.PRIVATE),Infinity>(ref=inReplyTo=Math.floor(data.inReplyTo))&&ref>0||(inReplyTo=void 0),attachments=data.attachments instanceof Array?data.attachments:void 0,message=null!=data.message?String(data.message):void 0,makeNSFW=null!=data.makeNSFW?!!data.makeNSFW:void 0,Request.call(this,"POST",Store.auth.origin+"/api/v1/statuses/",{status:text,in_reply_to_id:inReplyTo,media_ids:attachments?function(){var i,len,results;for(results=[],i=0,len=attachments.length;i<len;i++)(attachment=attachments[i])instanceof Attachment&&results.push(attachment.id);return results}():void 0,sensitive:makeNSFW?"true":void 0,spoiler_text:message,visibility:function(){switch(visibility){case Post.Visibility.PUBLIC:return"public";case Post.Visibility.UNLISTED:return"unlisted";case Post.Visibility.DIRECT:return"direct";default:return"private"}}()},Store.auth.accessToken,function(_this){return function(result){return dispatch("LaboratoryPostReceived",decree(function(){return _this.response=police(function(){return new Post(result)})}))}}(this)),Object.freeze(this)},Object.defineProperty(PostCreate,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:PostCreate}}))}),PostCreate}()},Delete:{configurable:!1,enumerable:!0,writable:!1,value:function(){var PostDelete;return PostDelete=function(data){var postID,ref;if(!(this&&this instanceof PostDelete))throw new TypeError("this is not a PostDelete");if(!(Infinity>(ref=postID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to create post; no id provided");return Request.call(this,"DELETE",Store.auth.origin+"/api/v1/statuses/"+postID,null,Store.auth.accessToken,function(_this){return function(result){return dispatch("LaboratoryPostDeleted",{id:postID})}}()),Object.freeze(this)},Object.defineProperty(PostDelete,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:PostDelete}}))}),PostDelete}()},SetReblog:{configurable:!1,enumerable:!0,writable:!1,value:function(){var PostSetReblog;return PostSetReblog=function(data){var postID,ref,value;if(!(this&&this instanceof PostSetReblog))throw new TypeError("this is not a PostSetReblog");if(!(Infinity>(ref=postID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to reblog post; no id provided");return value=!data.value||!!data.value,Request.call(this,"POST",Store.auth.origin+"/api/v1/statuses/"+postID+(value?"/reblog":"/unreblog"),null,Store.auth.accessToken,function(_this){return function(result){return dispatch("LaboratoryPostReceived",decree(function(){return _this.response=police(function(){return new Post(result)})}))}}(this)),Object.freeze(this)},Object.defineProperty(PostSetReblog,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:PostSetReblog}}))}),PostSetReblog}()},SetFavourite:{configurable:!1,enumerable:!0,writable:!1,value:function(){var PostSetFavourite;return PostSetFavourite=function(data){var postID,ref,value;if(!(this&&this instanceof PostSetFavourite))throw new TypeError("this is not a PostSetFavourite");if(!(Infinity>(ref=postID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to favourite post; no id provided");return value=!data.value||!!data.value,Request.call(this,"POST",Store.auth.origin+"/api/v1/statuses/"+postID+(value?"/favourite":"/unfavourite"),null,Store.auth.accessToken,function(_this){return function(result){return dispatch("LaboratoryPostReceived",decree(function(){return _this.response=police(function(){return new Post(result)})}))}}(this)),Object.freeze(this)},Object.defineProperty(PostSetFavourite,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:PostSetFavourite}}))}),PostSetFavourite}()}}),LaboratoryEvent.create("LaboratoryPostReceived",Post).create("LaboratoryPostDeleted",{id:void 0}).handle("LaboratoryPostReceived",function(event){var id,post,ref,type;if((post=event.detail)instanceof Post&&(type=post.type)instanceof Post.Type&&Infinity>(ref=id=Math.floor(post.id))&&ref>0)return Store[["notifications","statuses"][+!(type&Post.Type.NOTIFICATION)]][id]=post}).handle("LaboratoryPostDeleted",function(event){var id,ref;if(Infinity>(ref=id=Math.floor(event.detail.id))&&ref>0)return delete Store.statuses[id]}),Object.defineProperties(Profile,{Request:{configurable:!1,enumerable:!0,writable:!1,value:function(){var ProfileRequest;return ProfileRequest=function(data,isLive,useCached){var callback,profileID,ref,relationshipRequest,requestStart,requestStop;if(null==isLive&&(isLive=!0),null==useCached&&(useCached=!0),!(this&&this instanceof ProfileRequest))throw new TypeError("this is not a ProfileRequest");if(!(Infinity>(ref=profileID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to request profile; no id provided");return callback=function(_this){return function(event){var response;if((response=event.detail)instanceof Profile&&response.id===profileID&&(null!=response.compare&&response.compare(_this.response)||decree(function(){return _this.response=response}),!isLive))return _this.stop()}}(this),Request.call(this,"GET",Store.auth.origin+"/api/v1/accounts/"+profileID,null,Store.auth.accessToken,function(_this){return function(result){return result.id!==profileID?void _this.dispatchEvent(new CustomEvent("failure",{id:_this.id,request:_this,response:new Failure("Unable to fetch profile; returned profile did not match requested id")})):(dispatch("LaboratoryProfileReceived",new Profile(result)),relationshipRequest.start())}}(this)),relationshipRequest=new Request("GET",Store.auth.origin+"/api/v1/accounts/relationships",{id:profileID},Store.auth.accessToken,function(_this){return function(result){var ref1,relID,relationship,relationships;if(relationships=result[0],relID=relationships.id,relationship=Profile.Relationship.fromValue(Profile.Relationship.FOLLOWER*relationships.followed_by+Profile.Relationship.FOLLOWING*relationships.following+Profile.Relationship.REQUESTED*relationships.requested+Profile.Relationship.BLOCKING*relationships.blocking+Profile.Relationship.MUTING*relationships.muting+Profile.Relationship.SELF*(relID===Store.auth.me)||Profile.Relationship.UNKNOWN),(null!=(ref1=Store.profiles[relID])?ref1.relationship:void 0)!==relationship)return dispatch("LaboratoryProfileReceived",new Profile(Store.profiles[relID]||{id:relID},relationship))}}()),requestStart=this.start,requestStop=this.stop,Object.defineProperties(this,{start:{enumerable:!1,value:function(){if(!(useCached&&Store.profiles[profileID]instanceof Profile)||(decree(function(_this){return function(){return _this.response=Store.profiles[profileID]}}(this)),isLive))return document.addEventListener("LaboratoryProfileReceived",callback),requestStart()}},stop:{enumerable:!1,value:function(){return document.removeEventListener("LaboratoryProfileReceived",callback),requestStop(),relationshipRequest.stop()}}}),Object.freeze(this)},Object.defineProperty(ProfileRequest,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:ProfileRequest}}))}),ProfileRequest}()},SetFollow:{configurable:!1,enumerable:!0,writable:!1,value:function(){var ProfileSetFollow;return ProfileSetFollow=function(data){var profileID,ref,value;if(!(this&&this instanceof ProfileSetFollow))throw new TypeError("this is not a ProfileSetFollow");if(!(Infinity>(ref=profileID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to follow account; no id provided");return value=!data.value||!!data.value,Request.call(this,"POST",Store.auth.origin+"/api/v1/accounts/"+profileID+(value?"/follow":"/unfollow"),null,Store.auth.accessToken,function(_this){return function(result){return dispatch("LaboratoryProfileReceived",decree(function(){return _this.response=police(function(){return new Profile(result)})}))}}(this)),Object.freeze(this)},Object.defineProperty(ProfileSetFollow,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:ProfileSetFollow}}))}),ProfileSetFollow}()},SetBlock:{configurable:!1,enumerable:!0,writable:!1,value:function(){var ProfileSetBlock;return ProfileSetBlock=function(data){var profileID,ref,value;if(!(this&&this instanceof ProfileSetBlock))throw new TypeError("this is not a ProfileSetBlock");if(!(Infinity>(ref=profileID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to block account; no id provided");return value=!data.value||!!data.value,Request.call(this,"POST",Store.auth.origin+"/api/v1/accounts/"+profileID+(value?"/block":"/unblock"),null,Store.auth.accessToken,function(_this){return function(result){return dispatch("LaboratoryProfileReceived",decree(function(){return _this.response=police(function(){return new Profile(result)})}))}}(this)),Object.freeze(this)},Object.defineProperty(ProfileSetBlock,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:ProfileSetBlock}}))}),ProfileSetBlock}()},SetMute:{configurable:!1,enumerable:!0,writable:!1,value:function(){var ProfileSetMute;return ProfileSetMute=function(data){var profileID,ref,value;if(!(this&&this instanceof ProfileSetMute))throw new TypeError("this is not a ProfileSetMute");if(!(Infinity>(ref=profileID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to mute account; no id provided");return value=!data.value||!!data.value,Request.call(this,"POST",Store.auth.origin+"/api/v1/accounts/"+profileID+(value?"/mute":"/unmute"),null,Store.auth.accessToken,function(_this){return function(result){return dispatch("LaboratoryProfileReceived",decree(function(){return _this.response=police(function(){return new Profile(result)})}))}}(this)),Object.freeze(this)},Object.defineProperty(ProfileSetMute,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:ProfileSetMute}}))}),ProfileSetMute}()},LetFollow:{configurable:!1,enumerable:!0,writable:!1,value:function(){var ProfileLetFollow;return ProfileLetFollow=function(data){var profileID,ref,value;if(!(this&&this instanceof ProfileLetFollow))throw new TypeError("this is not a ProfileLetFollow");if(!(Infinity>(ref=profileID=Math.floor(null!=data?data.id:void 0))&&ref>0))throw new TypeError("Unable to follow account; no id provided");return value=!data.value||!!data.value,Request.call(this,"POST",Store.auth.origin+"/api/v1/follow_requests"+(value?"/authorize":"/reject"),{id:profileID},Store.auth.accessToken,function(_this){return function(result){}}()),Object.freeze(this)},Object.defineProperty(ProfileLetFollow,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:ProfileLetFollow}}))}),ProfileLetFollow}()}}),LaboratoryEvent.create("LaboratoryProfileReceived",Profile).handle("LaboratoryProfileReceived",function(event){var id,profile,ref;if((profile=event.detail)instanceof Profile&&Infinity>(ref=id=Math.floor(profile.id))&&ref>0)return Store.profiles[id]=profile}),LaboratoryEvent.create("LaboratoryRequestOpen",XMLHttpRequest).create("LaboratoryRequestUpdate",XMLHttpRequest).create("LaboratoryRequestComplete",XMLHttpRequest).create("LaboratoryRequestError",XMLHttpRequest),Object.defineProperty(Rolodex,"Request",{configurable:!1,enumerable:!0,writable:!1,value:function(){var RolodexRequest;return RolodexRequest=function(data,before,after){var limit,query,ref,type;if(!(this&&this instanceof RolodexRequest))throw new TypeError("this is not a RolodexRequest");if(!(type=Rolodex.Type.fromValue(data.type))||type===Rolodex.Type.UNDEFINED)throw new TypeError("Unable to request rolodex; no type provided");return query=null!=data.query?String(data.query):void 0,limit=Infinity>(ref=data.limit)&&ref>0?Math.floor(data.limit):void 0,Infinity>before&&before>0||(before=void 0),Infinity>after&&after>0||(after=void 0),Request.call(this,"GET",Store.auth.origin+function(){switch(type){case Rolodex.Type.SEARCH:return"/api/v1/accounts/search";case Rolodex.Type.FOLLOWERS:return"/api/v1/accounts/"+query+"/followers";case Rolodex.Type.FOLLOWING:return"/api/v1/accounts/"+query+"/following";case Rolodex.Type.FAVOURITED_BY:return"/api/v1/statuses/"+query+"/favourited_by";case Rolodex.Type.REBLOGGED_BY:return"/api/v1/statuses/"+query+"/reblogged_by";case Rolodex.Type.BLOCKS:return"/api/v1/blocks";case Rolodex.Type.MUTES:return"/api/v1/mutes";case Rolodex.Type.FOLLOW_REQUESTS:return"/api/v1/follow_requests"}}(),function(){switch(type){case Rolodex.Type.SEARCH:return{q:query,limit:limit};default:return{max_id:before,since_id:after}}}(),Store.auth.accessToken,function(_this){return function(result,params){var account,i,ids,len,ref1,ref2,ref3;for(ids=[],before=((null!=(ref1=params.prev)?ref1.match(/.*since_id=([0-9]+)/):void 0)||[])[1],after=((null!=(ref2=params.next)?ref2.match(/.*max_id=([0-9]+)/):void 0)||[])[1],i=0,len=result.length;i<len;i++)account=result[i],ref3=account.id,indexOf.call(ids,ref3)<0&&(ids.push(account.id),dispatch("LaboratoryProfileReceived",new Profile(account)));return decree(function(){return _this.response=police(function(){return new Rolodex(result)})})}}(this)),Object.defineProperties(this,{before:{enumerable:!0,get:function(){return before}},after:{enumerable:!0,get:function(){return after}},prev:{enumerable:!1,value:function(){return new RolodexRequest({type:type,query:query,limit:limit},void 0,before)}},next:{enumerable:!1,value:function(){return new RolodexRequest({type:type,query:query,limit:limit},after)}},loadMore:{enumerable:!1,value:function(_this){return function(){var callback,next;return callback=function(response){return after=next.after,decree(function(){return _this.response=police(function(){return this.response.join(response)})}),next.stop(),next.remove(callback)},(next=_this.next()).assign(callback),next.start()}}(this)},update:{enumerable:!1,value:function(_this){return function(keepGoing){var callback,prev;return callback=function(response){var prev;if(before=prev.before,decree(function(){return _this.response=police(function(){return this.response.join(response)})}),prev.stop(),prev.remove(callback),keepGoing&&response.length)return(prev=_this.prev()).assign(callback),prev.start()},(prev=_this.prev()).assign(callback),prev.start()}}(this)}}),Object.freeze(this)},Object.defineProperty(RolodexRequest,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:RolodexRequest},prev:{enumerable:!1,value:function(){}},next:{enumerable:!1,value:function(){}},loadMore:{enumerable:!1,value:function(){}},update:{enumerable:!1,value:function(){}}}))}),RolodexRequest}()}),Object.defineProperty(Timeline,"Request",{configurable:!1,enumerable:!0,writable:!1,value:function(){var TimelineRequest;return TimelineRequest=function(data,before,after){var isLocal,query,ref,type;if(!(this&&this instanceof TimelineRequest))throw new TypeError("this is not a TimelineRequest");if(!(type=Timeline.Type.fromValue(data.type))||type===Timeline.Type.UNDEFINED)throw new TypeError("Unable to request rolodex; no type provided");return query=null!=data.query?String(data.query):void 0,isLocal=!!data.isLocal,Infinity>(ref=data.limit)&&ref>0?Math.floor(data.limit):void 0,Infinity>before&&before>0||(before=void 0),Infinity>after&&after>0||(after=void 0),Request.call(this,"GET",Store.auth.origin+function(){switch(type){case Timeline.Type.HASHTAG:return"/api/v1/timelines/tag/"+query;case Timeline.Type.PUBLIC:return"/api/v1/timelines/public";case Timeline.Type.HOME:return"/api/v1/timelines/home";case Timeline.Type.NOTIFICATIONS:return"/api/v1/notifications";case Timeline.Type.FAVOURITES:return"/api/v1/favourites";case Timeline.Type.ACCOUNT:return"/api/v1/accounts/"+query+"/statuses";default:return"/api/v1"}}(),{local:isLocal||void 0,max_id:before,since_id:after},Store.auth.accessToken,function(_this){return function(result,params){var account,acctIDs,i,ids,j,k,l,len,len1,len2,len3,mention,mentionIDs,mentions,ref1,ref10,ref2,ref3,ref4,ref5,ref6,ref7,ref8,ref9,srcMentions,status;for(acctIDs=[],mentions=[],mentionIDs=[],ids=[],before=((null!=(ref1=params.prev)?ref1.match(/.*since_id=([0-9]+)/):void 0)||[])[1],after=((null!=(ref2=params.next)?ref2.match(/.*max_id=([0-9]+)/):void 0)||[])[1],i=0,len=result.length;i<len;i++)if(status=result[i],ref3=status.id,indexOf.call(ids,ref3)<0){for(ids.push(status.id),ref6=[status.account,null!=(ref4=status.status)?ref4.account:void 0,null!=(ref5=status.reblog)?ref5.account:void 0],j=0,len1=ref6.length;j<len1;j++)(account=ref6[j])&&(acctIDs.push(account.id),dispatch("LaboratoryProfileReceived",new Profile(account)));if((srcMentions=status.mentions||(null!=(ref7=status.status)?ref7.mentions:void 0)||(null!=(ref8=status.reblog)?ref8.mentions:void 0))instanceof Array)for(k=0,len2=srcMentions.length;k<len2;k++)account=srcMentions[k],ref9=account.id,indexOf.call(mentionIDs,ref9)<0&&(mentionIDs.push(account.id),mentions.push(account));dispatch("LaboratoryPostReceived",new Post(status))}for(l=0,len3=mentions.length;l<len3;l++)mention=mentions[l],ref10=mention.id,indexOf.call(acctIDs,ref10)<0&&null==Store.profiles[mention.id]&&dispatch("LaboratoryProfileReceived",new Profile(mention));return decree(function(){return _this.response=police(function(){return new Timeline(result)})})}}(this)),Object.defineProperties(this,{before:{enumerable:!0,get:function(){return before}},after:{enumerable:!0,get:function(){return after}},prev:{enumerable:!1,value:function(){return new TimelineRequest({type:type,query:query,isLocal:isLocal},void 0,before)}},next:{enumerable:!1,value:function(){return new TimelineRequest({type:type,query:query,isLocal:isLocal},after)}},loadMore:{enumerable:!1,value:function(_this){return function(){var callback,next;return callback=function(response){return after=next.after,decree(function(){return _this.response=police(function(){return this.response.join(response)})}),next.stop(),next.remove(callback)},(next=_this.next()).assign(callback),next.start()}}(this)},update:{enumerable:!1,value:function(_this){return function(keepGoing){var callback,prev;return callback=function(response){var prev;if(before=prev.before,decree(function(){return _this.response=police(function(){return this.response.join(response)})}),prev.stop(),prev.remove(callback),keepGoing&&response.length)return(prev=_this.prev()).assign(callback),prev.start()},(prev=_this.prev()).assign(callback),prev.start()}}(this)}}),Object.freeze(this)},Object.defineProperty(TimelineRequest,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(Object.create(Request.prototype,{constructor:{enumerable:!1,value:TimelineRequest},prev:{enumerable:!1,value:function(){}},next:{enumerable:!1,value:function(){}},loadMore:{enumerable:!1,value:function(){}},update:{enumerable:!1,value:function(){}}}))}),TimelineRequest}()}),Store=null,(Laboratory.reset=reset=function(){Store={auth:null,notifications:{},profiles:{},statuses:{}}})(),window["🏪"]=Store,Object.defineProperty(window,"Laboratory",{value:Object.freeze(Laboratory),enumerable:!0}),dispatch("LaboratoryInitializationLoaded"),run=function(){var handler,i,len,ref;for(ref=LaboratoryEvent.Handlers,i=0,len=ref.length;i<len;i++)handler=ref[i],document.addEventListener(handler.type,handler);return Exposed.ready=!0,dispatch("LaboratoryInitializationReady")},"complete"===document.readyState?run():window.addEventListener("load",run)}).call(this);